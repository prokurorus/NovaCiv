FILE_MAP  — структура проекта NovaCiv (novaciv.space)
Версия: 2025-12-03

Назначение файла
----------------
Этот файл — “карта” проекта для нас двоих.
Он помогает быстро вспомнить:
- какие директории и ключевые файлы существуют;
- за что отвечает каждая крупная часть;
- какие Netlify-функции и вспомогательные модули уже реализованы;
- что уже используется в бою, а что черновик.

При добавлении новых файлов:
- лучше всего сразу дописывать сюда краткое описание,
- чтобы в будущем не тратить время на повторное “распознавание” архитектуры.

Корень репозитория
------------------
/ (root)
- package.json, package-lock.json  — зависимости проекта (React, Vite, Firebase, Netlify Functions и т.д.).
- vite.config.*                    — конфигурация Vite (сборка фронтенда).
- tsconfig.* / jsconfig.*          — настройки TypeScript / пути импорта.
- index.html                       — HTML-шаблон для SPA (точка входа Vite).
- netlify.toml                     — конфигурация Netlify:
  - build.command = "npm run build"
  - publish = "dist"
  - директория функций: netlify/functions
- README.md                        — общее описание проекта (публичное).
- FILE_MAP_NovaCiv.txt             — этот файл-карта.

Папка public/
-------------
public/
- favicon.ico, og-image.png, robots.txt, sitemap.xml  — базовые статические файлы сайта.
- manifest.json                    — PWA-манифест.
- lovable-uploads/android.png      — текущий главный барельеф-андроид.
- placeholder.svg и др.            — вспомогательная графика.

Папка media/ — “Media Lab” и автогенерация видео
------------------------------------------------
media/
- .gitkeep                         — служебный.

media/backgrounds/
- .gitkeep                         — пока без реальных фонов.
- (в будущем) статические и анимированные подложки для шортов.

media/brand/
- .gitkeep
- style.md                         — заметки по визуальному стилю NovaCiv (барельеф, минимализм, монохром).

media/scripts/
- .gitkeep
- README.md                        — краткое описание медиа-конвейера.
- pipeline.js                      — ГЛАВНЫЙ конвейер генерации шортов:
  - берёт пресет (`shorts-presets/short_auto_citation.json`);
  - вызывает Домового по DOMOVOY_API_URL, получает цитату;
  - подбирает язык и голос по пресету;
  - генерирует аудио через OpenAI TTS;
  - применяет фон (статический или анимированный);
  - собирает всё в итоговый MP4 (через ffmpeg-static);
  - пишет результаты во временную папку (`/tmp/novaciv-media` в Netlify).

media/shorts-presets/
- .gitkeep
- short_auto_citation.json         — главный пресет автогенерации:
  - до ~40 секунд;
  - источник текста — Домовой (манифест + устав);
  - языки: ru/en/de/es, голоса из media/voices.
- short_citation_ru_30.json        — шорт-цитаты до ~30 сек, русский голос.
- short_citation_en_30.json        — то же, английский.
- short_citation_de_30.json        — то же, немецкий.
- short_citation_es_30.json        — то же, испанский.

media/subtitles/
- .gitkeep
- charter/                         — текстовые блоки для субтитров по Уставу.
  - ru_block_01.txt, en_block_01.txt
- manifest/                        — текстовые блоки для субтитров по Манифесту.
  - ru_block_01.txt, en_block_01.txt, de_block_01.txt, es_block_01.txt

media/voices/
- .gitkeep
- openai/
  - .gitkeep
  - nova_ru_calm.json              — спокойный, доверительный голос Домового (RU).
  - nova_en_inspire.json           — чуть более вдохновляющий голос (EN).
  - nova_de_calm.json              — спокойный голос (DE).
  - nova_es_calm.json              — спокойный голос (ES).

Папка netlify/ — серверные функции
----------------------------------
netlify/functions/*.js — серверная логика (OpenAI, Firebase, Telegram, рассылки, медиа).

ai-domovoy.js
  — Главный диалоговый ИИ-Домовой сайта.
  — Отвечает на вопросы, умеет цитировать Устав и Манифест, работать на RU/EN/DE.
  — Используется фронтом через хуки (useChat) и виджет помощника.

ai-voice.js
  — Голосовой модуль (TTS/ASR).
  — Работает с OpenAI Speech API.
  — Используется голосовым помощником (в будущем также Media Lab).

domovoy-auto-post.js
  — Автогенерация философских постов Домового без постинга в Telegram.
  — Режимы:
      1) charter_quote
      2) question_to_reader
      3) term_explainer
      4) charter_series (серии по разделам Устава)
  — Создаёт посты в Firebase (форум, раздел news / movement feed).

domovoy-reply.js
  — Ответчик Домового для Ленты:
      * ищет новые комментарии в разделе news,
      * отвечает мягким тоном,
      * помечает обработанные комментарии, чтобы не дублировать ответы.

domovoy-auto-reply.js
  — Вспомогательная функция автоответов (исторически; можно рассматривать как технический слой над domovoy-reply.js).

fetch-news.js
  — Подбор новостей из внешних RSS-лент.
  — Анализирует через OpenAI и создаёт темы в разделе news форума.
  — Ничего не постит в Telegram — только пишет в Firebase.

news-cron.js
  — Следит за новыми темами в news.
  — Решает, что уже можно отправлять в Telegram-каналы.

post-news-to-telegram.js
  — Берёт готовые новости из Firebase (раздел news) и отправляет их в Telegram-каналы по языкам.
  — Помечает отправленные посты (telegramPosted), чтобы исключить дубли.

post-to-telegram.js
  — Низкоуровневая работа с Telegram Bot API:
      * отправка сообщений,
      * переиспользуется несколькими функциями.

send-email.js
  — Отправка писем с сайта (формы обратной связи / “Присоединиться”).

generate-video.js   (НОВОЕ — Media Lab)
  — HTTP-функция `/.netlify/functions/generate-video`.
  — Запускает `media/scripts/pipeline.runPipeline()` в облаке (Netlify).
  — На выходе:
      * язык ролика,
      * текст цитаты,
      * путь к итоговому видеофайлу (MP4) в рабочей директории функции.
  — На данный момент только генерирует и возвращает информацию;
    дальнейший автопостинг в TikTok / YouTube / Telegram можно навесить позже.

Папка src/ — фронтенд
---------------------
src/main.tsx
- Точка входа фронтенда:
  - подключает React, Router, стили;
  - рендерит корневой <App />.

src/App.tsx
- Корневой компонент приложения:
  - общая рамка сайта,
  - подключение верхнего меню и LanguageSwitcher,
  - маршрутизация по страницам (Home, Vision, Manifesto, Charter, News, Forum, Join и т.д.).

src/index.css, src/App.css
- Базовые стили, Tailwind-классы, типографика.

src/components/
---------------
components/Header.tsx
  — Шапка сайта с логотипом NovaCiv и основным меню.

components/TopNav.tsx
  — Верхняя навигация (главные разделы, подсветка активного).

components/LanguageSwitcher.tsx
  — Переключатель языков (RU / EN / DE / ES и др.).
  — Синхронизирован со страницами и с форумом.

components/AssistantWidget.tsx
  — Виджет Домового:
      * плавающая кнопка на страницах,
      * окно чата,
      * связь с Netlify-функцией ai-domovoy.js
        через хуки и fetch.

components/SupporterCounter.tsx
  — Счётчики “Visitors / Likes / Joined” на странице Vision / Join.

components/ui/*
  — Набор базовых UI-компонентов (карточки, кнопки, дропдауны и т.п.)
    в стиле shadcn/ui.

src/hooks/
----------
hooks/useChat.ts
  — Логика общения с Домовым на фронтенде:
      * хранение истории сообщений;
      * вызов netlify-функции ai-domovoy;
      * обработка состояний (loading, error).

hooks/useMember.ts, useStats.ts
  — Работа с участниками и статистикой (лайки, счётчики присоединившихся).

hooks/use-mobile.tsx
  — Мелкие адаптивные вещи для мобильных устройств.

hooks/useToast.ts
  — Всплывающие уведомления.

src/lib/
--------
lib/firebase.ts
  — Клиент Firebase Realtime Database.
  — Используется для форума, новостей, счётчиков.

lib/counters.ts
  — Работа со статистикой (visitors, likes, joined).

lib/utils.ts
  — Вспомогательные функции (классы, форматирование и т.д.).

src/data/
---------
data/translations.ts
  — Тексты и переводы для многоязычного интерфейса
    (заголовки, подписи кнопок и т.п.).

src/pages/ — основные страницы
------------------------------
pages/Home.tsx
  — Стартовый экран (вход в сознание, “вторая главная”).
  — Лёгкая подача философии NovaCiv.

pages/Index.tsx
  — Технический роут, обычно редирект/организация главной.

pages/Vision.tsx
  — Страница “Our Vision / Наше видение”:
      * блоки Manifesto / Charter,
      * счётчики visitors/likes/joined.

pages/Manifesto-*.tsx, Manifesto.tsx
  — Страницы Манифеста на разных языках (RU/EN/DE/ES).
  — Текст уже финальный, без жирных выделений, только `whitespace-pre-wrap`.

pages/Charter-*.tsx, Charter.tsx
  — Страницы Устава на разных языках.
  — Структура: преамбулы + нормативы, вся разметка выровнена
    для корректного отображения на сайте.

pages/News.tsx
  — Лента движения NovaCiv:
      * выводит темы раздела news из Firebase;
      * фильтрация по языкам;
      * ссылки на обсуждение в форуме.

pages/ForumPage.tsx
  — Интерфейс форума:
      * разделы, темы, ответы;
      * лайки, избранное;
      * связь с Firebase.

pages/TopicPage.tsx
  — Просмотр конкретной темы форума + ветка комментариев.

pages/Join.tsx
  — Страница “Присоединиться”:
      * два больших счётчика (присоединились / нравится);
      * кнопки “Присоединяюсь” и “Мне нравится”;
      * вёрстка под десктоп и мобайл.

pages/NotFound.tsx
  — 404-страница.

Как пользоваться этой картой
----------------------------
1. Перед изменениями структуры:
   - пробегись глазами по этому файлу, чтобы вспомнить, что уже есть.
2. После добавления новых страниц/функций/модулей:
   - добавь сюда 1–3 строки описания в тот же стиль.
3. Когда нужно “показать конкретный файл”:
   - просто скажи мне путь из этой карты (например,
     `netlify/functions/generate-video.js` или
     `media/shorts-presets/short_auto_citation.json`) —
     и можно работать точечно, без пересылки всего архива.

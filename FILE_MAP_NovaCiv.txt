FILE_MAP  — структура проекта NovaCiv (novaciv.space)
Версия: 2025-11-29

Назначение файла
----------------
Этот файл — “карта” проекта для нас двоих.
Он помогает быстро вспомнить:
- какие директории и ключевые файлы существуют;
- за что отвечает каждая крупная часть;
- какие Netlify-функции и вспомогательные модули уже реализованы;
- что уже используется в бою, а что черновик.

При добавлении новых файлов:
- лучше всего сразу дописывать сюда краткое описание,
- чтобы в будущем не тратить время на повторное “распознавание” архитектуры.

Корень репозитория
------------------
/ (root)
- package.json, package-lock.json  — зависимости проекта (React, Vite, Firebase, Netlify functions и т.д.).
- vite.config.*                    — конфигурация Vite (сборка фронтенда).
- tsconfig.* / jsconfig.*          — настройки TypeScript / пути импорта.
- index.html                       — HTML-шаблон для SPA (точка входа Vite).
- netlify.toml                     — конфигурация Netlify:
  - build.command = "npm run build"
  - publish = "dist"
  - указание директории функций: netlify/functions
- README.md                        — общее описание проекта (публичное).
- FILE_MAP_NovaCiv.txt             — этот файл-карта.

Папка public/
-------------
- favicon, иконки, статические изображения.
- Могут лежать исходные версии картинок (андроид-барельеф и т.п.).

Папка netlify/
--------------
netlify/functions/*.js — серверная логика (OpenAI, Firebase, Telegram, рассылки).
Используют:
  - OpenAI API
  - Firebase Realtime Database
  - Telegram Bot API
  - SendGrid API
  - Cron-запуски с секретами (DOMOVOY_CRON_SECRET и др.)

Функции:

netlify/functions/post-news-to-telegram.js – берёт готовые новости из Firebase (forum/topics, section "news") и отправляет их в телеграм-каналы по языкам, помечая отправленные через поле telegramPosted.


ai-domovoy.js
  — Главный диалоговый ИИ-домовой сайта.
  — Отвечает на вопросы пользователей.
  — Умеет:
      * цитировать Устав,
      * объяснять пункты,
      * подгружать контекст Ленты и форума,
      * работать на разных языках (RU/EN/DE),
      * взаимодействовать с фронтом через src/lib/domovoy.ts.

domovoy-auto-post.js
  — netlify/functions/domovoy-auto-post.js – Домовой генерит философские посты и пишет в Firebase, без постинга;
  — Каждые N часов создаёт философский пост в трёх языках.
  — Поддерживает 4 режима:
       1) charter_quote
       2) question_to_reader
       3) term_explainer
       4) charter_series  (НОВОЕ — серии по разделам Устава)
  — Используется детерминированная смена режима по часу UTC.
  — В режиме series берёт следующий раздел Устава (по циклу) и создаёт часть серии.
  — Сохраняет посты в /forum/topics 

domovoy-reply.js   (НОВОЕ)
  — Ответчик Домового для Ленты.
  — Раз в запуск:
        * ищет новые комментарии под постами раздела news,
        * отвечает спокойным тоном Домового,
        * создаёт ответ в /forum/comments/,
        * помечает исходный комментарий domovoyReplied: true.
  — Ограничение: максимум 3 ответа за один запуск (чтобы не спамить).
  — Три языка поддерживаются автоматически.

ai-voice.js
  — Голосовой модуль (TTS/ASR).
  — Работает с OpenAI Speech API.
  — Используется в голосовом помощнике.

fetch-news.js
  — Загрузка мировых новостей из RSS.
  — Анализирует текст через OpenAI.
  — Создаёт темы в разделе news форума (минимально обработанные).
    netlify/functions/fetch-news.js – собирает и анализирует новости, записывает в Firebase, НИЧЕГО не постит сам;


news-cron.js
  — Рассылка новых тем из news в Telegram-каналы.
  — Помечает отправленные темы, чтобы избежать дублей.

post-to-telegram.js
  — Низкоуровневая отправка сообщений в Telegram.
  — Используется другими функциями.

send-email.js
  — Отправка писем с сайта (форма контакта).


Папка src/
----------
src/main.tsx
- Точка входа фронтенда:
  - подключает React, роутер, глобальные стили.
  - рендерит корневой компонент (обычно <App /> или аналог).

src/App.tsx (или аналогичный корневой компонент)
- Описывает общую “рамку” сайта:
  - верхнее меню (Главная / Наше видение / Устав / Манифест / Форум / Присоединиться / и т.д.),
  - переключатель языков,
  - маршрутизацию по страницам.

src/pages/
- Home / Landing (главная)       — философский экран с андроидом, кнопкой “Войти в сознание” и кратким описанием NovaCiv.
- Manifest*.tsx                  — страницы манифеста (на разных языках).
- Charter*.tsx                   — страницы устава (на разных языках).
- Join.tsx                       — страница “Присоединиться” (счётчики, кнопки “Присоединяюсь / Мне нравится” и т.п.).
- ForumPage.tsx                  — интерфейс форума: разделы, темы, ответы.
- News.tsx                       — Лента движения NovaCiv (список новостей/тем из форума, фильтрация по языкам).
- Дополнительные страницы        — Drivers.tsx (для MobilTruck), info-страницы, служебные экраны.

src/components/
- Общие визуальные компоненты:
  - шапка/меню, футер;
  - карточки текста;
  - переключатель языков;
  - блоки оформления (андроид-барельеф и прочее).

src/lib/
--------
domovoy.ts
  — Клиентский интерфейс для общения фронтенда с функцией ai-domovoy.js.
  — Формирует запросы, передаёт историю сообщений и текст текущей страницы.
  — Не генерирует ответы — только делает запросы на сервер.

firebase.ts / api.ts
  — Чтение/запись тем форума, ленты новостей, комментариев.
  — Используется News.tsx, ForumPage.tsx и функциями домового.



Папка styles/ или глобальные стили
----------------------------------
- tailwind.css / index.css / globals.css
- Настройки Tailwind / кастомные классы / базовая типографика.

Как пользоваться этой картой
----------------------------
1. Перед изменениями архитектуры или добавлением новых файлов:
   - пробегаемся глазами по этому файлу, чтобы вспомнить, что уже есть.
2. После добавления новых страниц, функций или важных модулей:
   - добавляем сюда 1–3 строки описания, **по тому же стилю**.
3. При следующем заходе в проект:
   - сначала смотрим FILE_MAP_NovaCiv.txt, потом уже открываем нужные файлы.

Если в будущем структура заметно изменится (например, вынесем форум в отдельный пакет или добавим ещё 5–10 Netlify-функций), имеет смысл сделать короткую “версию 2” карты, не стирая старую историю, а пометив её как устаревшую.

# üîç NEWS PIPELINE DIAGNOSIS ‚Äî –ò–¢–û–ì–û–í–´–ô –û–¢–ß–ï–¢

**Date:** 2026-01-11  
**Issue:** news-cron –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ, –Ω–æ –ø–æ—Å—Ç—ã –≤ Telegram –Ω–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è

---

## üìä –ü–†–û–í–ï–†–ö–ê –ö–û–î–ê

### 1. ‚úÖ RSS-–∏—Å—Ç–æ—á–Ω–∏–∫–∏

**–§–∞–π–ª:** `netlify/functions/fetch-news.js`, —Å—Ç—Ä–æ–∫–∏ 28-74

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ **9 –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤** (3 RU, 3 EN, 3 DE)
- ‚úÖ –ú–∞—Å—Å–∏–≤ `SOURCES` –Ω–µ –ø—É—Å—Ç–æ–π
- ‚úÖ –ù–µ—Ç —É—Å–ª–æ–≤–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –¥–µ–ª–∞—é—Ç —Å–ø–∏—Å–æ–∫ –ø—É—Å—Ç—ã–º
- ‚úÖ –ù–µ—Ç feature flags, –≤–ª–∏—è—é—â–∏—Ö –Ω–∞ —Å–ø–∏—Å–æ–∫

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ:** `MAX_NEW_ITEMS_PER_RUN = 2` (–º–∞–∫—Å–∏–º—É–º 2 –Ω–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–∞ –∑–∞ –∑–∞–ø—É—Å–∫)

---

### 2. ‚ö†Ô∏è –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ–º (fetch-news) ‚Äî –¢–†–ï–ë–£–ï–¢ –ü–†–û–í–ï–†–ö–ò –õ–û–ì–û–í

**–ú–µ—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫–∏:** Netlify Dashboard ‚Üí Functions ‚Üí fetch-news ‚Üí Logs

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- –ï—Å—Ç—å –ª–∏ scheduled –∑–∞–ø—É—Å–∫–∏ (–∫–∞–∂–¥—ã–µ 3 —á–∞—Å–∞)
- –ò–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å "Run now" –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏

**–ß—Ç–æ –∏—Å–∫–∞—Ç—å:**
- `processed: 0` ‚Üí –Ω–µ—Ç –Ω–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- `processed: 2` ‚Üí —Å–æ–∑–¥–∞–Ω–æ 2 —Ç–µ–º—ã (–ª–∏–º–∏—Ç)
- Error messages ‚Üí –æ—à–∏–±–∫–∏

---

### 3. ‚ö†Ô∏è Firebase ‚Äî –¢–†–ï–ë–£–ï–¢ –ü–†–û–í–ï–†–ö–ò –ë–ê–ó–´

**–ú–µ—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫–∏:** Firebase Console ‚Üí Realtime Database ‚Üí `/forum/topics`

**Query:** `/forum/topics.json?orderBy="section"&equalTo="news"`

**–ß—Ç–æ –ø–æ–¥—Å—á–∏—Ç–∞—Ç—å:**
- **Total news topics:** –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ–º —Å `section === "news"`
- **Pending for telegram:** –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ–º –ë–ï–ó `telegramPostedAt`

**–°–∫—Ä–∏–ø—Ç:** `node scripts/diagnose-news-pipeline.mjs` (—Ç—Ä–µ–±—É–µ—Ç FIREBASE_DB_URL)

---

### 4. ‚úÖ –§–∏–ª—å—Ç—Ä –≤ news-cron

**–§–∞–π–ª:** `netlify/functions/news-cron.js`, —Å—Ç—Ä–æ–∫–∏ 318-321

**–ö–æ–¥ —Ñ–∏–ª—å—Ç—Ä–∞:**
```javascript
const freshTopics = topics
  .filter((t) => !t.telegramPostedAt)
  .sort((a, b) => (a.createdAt || 0) - (b.createdAt || 0))
  .slice(0, limit);
```

**Query:** `/forum/topics.json?orderBy="section"&equalTo="news"`

**–£—Å–ª–æ–≤–∏—è:**
1. ‚úÖ `section === "news"` (—Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ)
2. ‚úÖ `!telegramPostedAt` (–ø–æ–ª–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç)

**–ö–æ–¥ –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω.** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –≤ Firebase.

---

## üéØ ROOT CAUSE (Most Likely)

**Root Cause:** –û—á–µ—Ä–µ–¥—å –ø—É—Å—Ç–∞ ‚Äî –≤—Å–µ —Ç–µ–º—ã —É–∂–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω—ã (–≤—Å–µ –∏–º–µ—é—Ç `telegramPostedAt`)

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**
- –ö–æ–¥ —Ñ–∏–ª—å—Ç—Ä–∞ –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω
- RSS –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- –ù–∞–∏–±–æ–ª–µ–µ –≤–µ—Ä–æ—è—Ç–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞ –ø—Ä–∏ —É—Å–ø–µ—à–Ω—ã—Ö –∑–∞–ø—É—Å–∫–∞—Ö news-cron

---

## üîß MINIMAL FIX

### Fix 1: –î–æ–∂–¥–∞—Ç—å—Å—è –Ω–æ–≤—ã—Ö —Ç–µ–º

**–î–µ–π—Å—Ç–≤–∏–µ:** –ü–æ–¥–æ–∂–¥–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π –∑–∞–ø—É—Å–∫ fetch-news (–∫–∞–∂–¥—ã–µ 3 —á–∞—Å–∞)

**–ö–æ–≥–¥–∞:** 00:00, 03:00, 06:00, 09:00, 12:00, 15:00, 18:00, 21:00 UTC

---

### Fix 2: –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é —Ç–µ–º—É (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏)

**–î–µ–π—Å—Ç–≤–∏–µ:** –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é —Ç–µ–º—É –±–µ–∑ `telegramPostedAt`

**–ö–æ–º–∞–Ω–¥–∞:**
```bash
node scripts/create-test-news-topic.mjs
```

**–ó–∞—Ç–µ–º:** –ó–∞–ø—É—Å—Ç–∏—Ç—å news-cron –≤—Ä—É—á–Ω—É—é (Netlify Dashboard ‚Üí "Run now")

---

### Alternative Fix (–µ—Å–ª–∏ fetch-news –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç):

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ fetch-news –Ω–∞ –æ—à–∏–±–∫–∏
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å env: `OPENAI_API_KEY`, `FIREBASE_DB_URL`
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `/newsMeta/en.json` (–≤–æ–∑–º–æ–∂–Ω–æ, –≤—Å–µ –Ω–æ–≤–æ—Å—Ç–∏ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã)

---

## ‚úÖ –ö–ê–ö –ü–†–û–í–ï–†–ò–¢–¨ –ü–û–°–õ–ï FIX

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Firebase

**–í Firebase Console:**
- –û—Ç–∫—Ä—ã—Ç—å `/forum/topics`
- –ü–æ–¥—Å—á–∏—Ç–∞—Ç—å —Ç–µ–º—ã –ë–ï–ó `telegramPostedAt`

**–ò–ª–∏ —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç:**
```bash
node scripts/diagnose-news-pipeline.mjs
```

---

### –®–∞–≥ 2: Run fetch-news (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

**–í Netlify Dashboard:**
1. Functions ‚Üí fetch-news ‚Üí "Run now"
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: `processed > 0`
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Firebase: –ø–æ—è–≤–∏–ª–∏—Å—å –ª–∏ –Ω–æ–≤—ã–µ —Ç–µ–º—ã

---

### –®–∞–≥ 3: Run news-cron

**–í Netlify Dashboard:**
1. Functions ‚Üí news-cron ‚Üí "Run now"
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:
   - `processed > 0` (—Ç–µ–º—ã –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã)
   - `totalSent > 0` (–æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ Telegram)
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Telegram: –ø–æ—è–≤–∏–ª—Å—è –ª–∏ –ø–æ—Å—Ç

---

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç

**–í Firebase:**
- –¢–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –ø–æ–ª—É—á–∏—Ç—å –ø–æ–ª–µ `telegramPostedAt`

**–í Telegram:**
- –ü–æ—Å—Ç –¥–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è –≤ –∫–∞–Ω–∞–ª–µ(–∞—Ö)

---

## üìã SUMMARY TABLE

| Check | Status | Result |
|-------|--------|--------|
| **RSS Sources** | ‚úÖ OK | 9 –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤, –Ω–µ –ø—É—Å—Ç–æ–π |
| **fetch-news Logs** | ‚ö†Ô∏è REQUIRES CHECK | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ Netlify Dashboard |
| **Firebase Topics** | ‚ö†Ô∏è REQUIRES CHECK | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É |
| **Filter Logic** | ‚úÖ OK | –ö–æ–¥ –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω |

---

## üìù ROOT CAUSE (One Sentence)

**Root Cause:** –û—á–µ—Ä–µ–¥—å –ø—É—Å—Ç–∞ ‚Äî –≤—Å–µ —Ç–µ–º—ã —Å `section: "news"` —É–∂–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω—ã (–∏–º–µ—é—Ç `telegramPostedAt`), –Ω–æ–≤—ã—Ö —Ç–µ–º –Ω–µ—Ç –≤ –±–∞–∑–µ.

---

## üîß CONCRETE FIX (1-2 –ø—É–Ω–∫—Ç–∞)

**Fix:**
1. **–î–æ–∂–¥–∞—Ç—å—Å—è –Ω–æ–≤—ã—Ö —Ç–µ–º –æ—Ç fetch-news** (–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 3 —á–∞—Å–∞: 00:00, 03:00, 06:00, 09:00, 12:00, 15:00, 18:00, 21:00 UTC)
2. **–ò–ª–∏ —Å–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é —Ç–µ–º—É** –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏: `node scripts/create-test-news-topic.mjs`, –∑–∞—Ç–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç—å news-cron –≤—Ä—É—á–Ω—É—é

---

## ‚úÖ VERIFICATION STEPS

1. **Run fetch-news:**
   - Netlify Dashboard ‚Üí Functions ‚Üí fetch-news ‚Üí "Run now"
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: `processed > 0`

2. **Check Firebase:**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø–æ—è–≤–∏–ª–∏—Å—å –Ω–æ–≤—ã–µ —Ç–µ–º—ã –ë–ï–ó `telegramPostedAt`

3. **Run news-cron:**
   - Netlify Dashboard ‚Üí Functions ‚Üí news-cron ‚Üí "Run now"
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: `processed > 0, totalSent > 0`

4. **Check Telegram:**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞–Ω–∞–ª—ã –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –Ω–æ–≤—ã—Ö –ø–æ—Å—Ç–æ–≤

---

**Status:** ‚úÖ Code Analysis Complete  
**Next Steps:** Manual verification in Netlify Dashboard and Firebase Console

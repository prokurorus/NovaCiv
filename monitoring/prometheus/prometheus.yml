# Prometheus Configuration for NovaCiv
# This file configures Prometheus to scrape metrics from PM2 processes

global:
  scrape_interval: 15s      # How frequently to scrape targets
  evaluation_interval: 15s  # How frequently to evaluate rules
  external_labels:
    cluster: 'novaciv-vps'
    environment: 'production'

# Alertmanager configuration (optional, for future use)
# alerting:
#   alertmanagers:
#     - static_configs:
#         - targets:
#           - alertmanager:9093

# Load rules once and periodically evaluate them
# rule_files:
#   - "alert_rules.yml"

# Scrape configurations
scrape_configs:
  # Prometheus itself
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
        labels:
          service: 'prometheus'

  # PM2 Exporter - collects metrics from PM2 processes
  - job_name: 'pm2'
    static_configs:
      - targets: ['localhost:9615']  # PM2 default metrics port
        labels:
          service: 'pm2'
          instance: 'novaciv-vps'

  # Node Exporter - system metrics (CPU, memory, disk, network)
  - job_name: 'node'
    static_configs:
      - targets: ['localhost:9100']
        labels:
          service: 'node-exporter'
          instance: 'novaciv-vps'

  # Custom NovaCiv metrics endpoint (if we add one)
  - job_name: 'novaciv-apps'
    static_configs:
      - targets: ['localhost:3001']  # admin-domovoy-api port
        labels:
          service: 'admin-domovoy'
          instance: 'novaciv-vps'
    metrics_path: '/metrics'  # If we add metrics endpoint
    scrape_interval: 30s

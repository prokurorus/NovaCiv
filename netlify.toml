[build]
  command = "npm run build"
  publish = "dist"
  functions = "netlify/functions"

[build.environment]
  NODE_VERSION = "18"

[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

[functions]
  # кладём статические файлы (фоновые картинки и т.п.)
  included_files = ["media/**"]
  # говорим Netlify не упаковывать ffmpeg-static внутрь бандла, а подложить как внешний модуль
  external_node_modules = ["ffmpeg-static"]
  # на всякий случай фиксируем бандлер
  node_bundler = "esbuild"

[functions."news-cron"]
  # Раз в час по UTC
  schedule = "0 * * * *"
[functions."create-video-job"]
  # создаём задачу (выбирает следующий язык по кругу)
  schedule = "0 8,20 * * *"

[functions."process-video-jobs"]
  # через пару минут после создания забираем и обрабатываем
  schedule = "5 8,20 * * *"

  [functions."auto-create-video-job"]
  # КАЖДЫЙ ЗАПУСК = 4 задачи (en, ru, de, es)
  # Пример: 2 раза в день (08:00 и 20:00 по UTC)
  schedule = "0 8,20 * * *"

[functions."process-video-jobs"]
  # Обработка очереди. Можно запускать чаще, чем создаём задачи.
  # Здесь пример: каждые 15 минут.
  schedule = "*/15 * * * *"

